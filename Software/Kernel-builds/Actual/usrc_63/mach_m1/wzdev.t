        opt     nol        lib     sysconfig.h        if      (NET=1)        lib     ../include/params.h        lib     ../include/macdefs.h        lib     ../include/wzsock.h        lib     ../include/fio.h        lib     ../include/fio_ctrl.h        lib     ../include/nwp_codes.h        opt     lis        data** basic net device* its purpose is to set the local side* of the w5500 device*        global  wzopn,wzcls,wzrdd,wzwrd,wzspcwzopfl  rzb     1wzopn   equ     *        pshs    x,y,u        tstb        bne     01f        tst     wzopfl        bne     01f        inc     wzopfl02      puls    x,y,u,pc01      lda     #EBSY        sta     uerror        bra     02bwzcls   equ     *        clr     wzopfl        rts** read configuration data*wzrdd   equ     *        pshs    x,y,u        ldy     #NWP0        ldu     fio_dba,y        ldx     fifo_us1,u      offset to GW data        addr    U,X             U + X -> X*        lda     uicnt+1        cmpa    #WZLCSZ        DCFLEN        bne     81f*        pshs    x,u        tfr     x,u            U points to fifo_us1        lda     #2             wzrdev        ldb     #S_SPCL        jsr     fio_msg        this read the device registers back        puls    x,u        lda     #WZLCSZ        DCFLEN02      pshs    a        ldb     0,x+        pshs    x,y,u        jsr     passc        puls    x,y,u          uistrt / uicnt        puls    a        bmi     03f        deca        bne     02b*03      puls    x,y,u,pc** write configuration data*wzwrd   equ     *        pshs    x,y,u        ldy     #NWP0        ldu     fio_dba,y        ldx     fifo_us1,u        addr    U,X             U + X -> X*        lda     uicnt+1         check 'specific size'        cmpa    #WZLCSZ         DCFLEN        blo     81f        lda     #WZLCSZ*        pshs    x               us1 address02      pshs    a,x,y,u        jsr     cpass        puls    a,x,y,u        bmi     03f        stb     0,x+        deca        bne     02b*03      ldb     #S_SPCL        lda     #0        puls    u               make U point to us1 area        jsr     fio_msg         tell IOP to put it in device*        puls    x,y,u,pcwzspc   equ     *        tfr     x,y        sty     -2,s            test Y        bne     doget* doset        lda     usarg0+1        ldy     #NWP0        ldu     fio_dba,y        ldx     fifo_us1,u        leax    32,x        tfr     x,u             special area        ldb     #S_SPCL        jsr     fio_msg         make IOP do it        rtsdoget81      lda     #EBARG        sta     uerror        puls    x,y,u,pc** preliminary setup* laster this info will be provided by the (root) user*wzconf        fcb     192,168,1,177   assigned IP address        fcb     255,255,255,0   netmask        fcb     192,168,1,150   gateway IP        fcb     'T,'S,'C,'U,'F,$01 mac addresswzactv  fcb     0        fcb     0,0,0DCFLEN  equ     *-wzconf        should match WZLCSZ        else        data        nop        endif        end